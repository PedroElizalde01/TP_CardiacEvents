---
title: "Graphs"
author: "Grupo 4"
date: "2021"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(plotly)

dataset <- read_excel("C:/Users/Pedro/Desktop/dataset.xlsx")
```

```{r, include=FALSE}
plot_ly(x = c(20, 14, 23), y = c('giraffes', 'orangutans', 'monkeys'), type = 'bar', orientation = 'h')
```

# 1. Frecuencia de edad
```{r ,echo=FALSE}
less20 <- subset(dataset, dataset$EDAD <20)
between20n40 <- subset(dataset, dataset$EDAD >=20 & dataset$EDAD <40)
between40n60 <- subset(dataset, dataset$EDAD >=40 & dataset$EDAD <60)
between60n80 <- subset(dataset, dataset$EDAD >=60 & dataset$EDAD <80)
more80 <- subset(dataset, dataset$EDAD >80)


plot_ly(alpha = 0.7, orientation = 'h') %>%
  add_histogram(y = less20$EDAD, name = "Less than 20") %>%
  add_histogram(y = between20n40$EDAD, name = "20 and 40") %>%
  add_histogram(y = between40n60$EDAD, name = "40 and 60") %>%
  add_histogram(y = between60n80$EDAD, name = "60 and 80") %>%
  add_histogram(y = more80$EDAD, name = "more than 80") %>%
layout(barmode = "group", title = "",orientation="h")


```

# 2. Pie Chart de sexo
```{r ,echo=FALSE}
plot_ly(dataset, labels = ~SEXO, type = 'pie', width = 1) %>%
  layout(title = '',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

```

# Análisis de Relacion Edad - Sexo 
```{r ,echo=FALSE}
menSubset <- dataset[which(dataset$SEXO == "MASC"),]
density1 <- density(menSubset$EDAD)

womenSubset <- dataset[which(dataset$SEXO == "FEME"),]
density2 <- density(womenSubset$EDAD)

plot_ly(x = ~density1$x, y = density1$y, type = 'scatter', mode = 'lines', name = 'Hombre', fill = 'tozerox')%>% 
  add_trace(x = ~density2$x, y = density2$y, name = 'Mujer', fill = 'tozerox')%>% 
  layout(xaxis = list(title = 'Edad'),yaxis = list(title = 'Densidad'))
```



# 3. Frecuencia acumulada de procedimiento
```{r ,echo=FALSE}
dataset <- subset(dataset, dataset$PROCEDIMIENTO == "ANGIOPLASTIA" |dataset$PROCEDIMIENTO == "CIRUGIA")

plot_ly(alpha = 0.6,
        marker = list(color = c('rgba(0,48,94,0.7)', 'rgba(221,117,0,0.7)',
                                'rgba(204,204,204,0.7)', 'rgba(1,6,132,0.7)'))) %>%
  add_histogram(x = dataset$PROCEDIMIENTO) %>%
  layout(barmode = "group", title = "")
```
#### Nota: Debido a la poca cantidad de pacientes en "endoválvula" y "cirugia,endoválvula", decidimos no incluir estos datos en nuestro análisis.

# 4. Procedimiento según factor de riesgo
```{r ,echo=FALSE}
diabetes <- subset(dataset, dataset$DIABETES ==1)
epoc  <- subset(dataset, dataset$EPOC ==1)
obesidadMor <- subset(dataset, dataset$`OBESIDAD MORBIDA` == 1)
plot_ly(alpha = 0.6) %>%
  add_histogram(x = diabetes$PROCEDIMIENTO, name = "Diabetes") %>%
  add_histogram(x = epoc$PROCEDIMIENTO, name = "EPOC") %>%
  add_histogram(x = obesidadMor$PROCEDIMIENTO, name = "Obesidad Morbida") %>%
  layout(barmode = "group", title = "")
```

# 5. Procedimiento según la cantidad de vasos

```{r ,echo=FALSE}
cerovasos <- dataset[!complete.cases(dataset$`Resumen Coronariopatia`),]
unVaso <- subset(dataset, dataset$`Resumen Coronariopatia` == "1 vaso")
dosVasos <- subset(dataset, dataset$`Resumen Coronariopatia` == "2 vasos")
tresVasos <- subset(dataset, dataset$`Resumen Coronariopatia` == "3 vasos")

plot_ly(alpha = 0.6) %>%
  add_histogram(x = cerovasos$PROCEDIMIENTO, name = "Cero Vasos") %>%
  add_histogram(x = unVaso$PROCEDIMIENTO, name = "Un Vaso") %>%
  add_histogram(x = dosVasos$PROCEDIMIENTO, name = "Dos Vasos") %>%
  add_histogram(x = tresVasos$PROCEDIMIENTO, name = "Tres Vasos") %>%
layout(barmode = "group", title = "")
```

# 6. Intervensión previa de ingresados
```{r ,echo=FALSE}
angioSubset <- subset(dataset, dataset$PROCEDIMIENTO == "ANGIOPLASTIA")
cirugiaSubset<- subset(dataset, dataset$PROCEDIMIENTO == "CIRUGIA")

plot_ly()%>%
  add_pie(labels = angioSubset$`INTERVENCION PREVIA`, values = angioSubset, domain = list(x = c(0, 0.4), y = c(0.5)), name = "Angioplastia",title = "ANGIOPLASTIA")%>%
  add_pie(labels = cirugiaSubset$`INTERVENCION PREVIA`, values = cirugiaSubset, domain = list(x = c(0.6, 1), y = c(0.5)), name = "Cirugia",title = "CIRUGIA") %>%
  layout(title = "", showlegend = F,
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

```

# 7. Vasos que desarrolla según sexo y edad
#### Hombres
```{r ,echo=FALSE}
menSubset <- dataset[which(dataset$SEXO == "MASC"),]

vasos1mCoronarioDataset <- density(subset(menSubset, menSubset$`Resumen Coronariopatia`=="1 vaso")$EDAD)

vasos2mCoronarioDataset <- density(subset(menSubset, menSubset$`Resumen Coronariopatia`=="2 vasos")$EDAD)

vasos3mCoronarioDataset <- density(subset(menSubset, menSubset$`Resumen Coronariopatia`=="3 vasos")$EDAD)

plot_ly(x = ~vasos1mCoronarioDataset$x, y = ~vasos1mCoronarioDataset$y, type = 'scatter', mode = 'lines', name = '1 vaso', fill = 'tozeroy')%>% 
  add_trace(x = ~vasos2mCoronarioDataset$x, y = ~vasos2mCoronarioDataset$y, name = '2 vasos', fill = 'tozeroy')%>%
  add_trace(x = ~vasos3mCoronarioDataset$x, y = ~vasos3mCoronarioDataset$y, name = '3 vasos', fill = 'tozeroy')%>%
  layout(xaxis = list(title = 'Age'),yaxis = list(title = 'Density'))

```

#### Mujeres

```{r ,echo=FALSE}
womenSubset <- dataset[which(dataset$SEXO == "FEME"),]

vasos1fCoronarioDataset <- density(subset(womenSubset, womenSubset$`Resumen Coronariopatia`=="1 vaso")$EDAD)
vasos2fCoronarioDataset <- density(subset(womenSubset, womenSubset$`Resumen Coronariopatia`=="2 vasos")$EDAD)
vasos3fCoronarioDataset <- density(subset(womenSubset, womenSubset$`Resumen Coronariopatia`=="3 vasos")$EDAD)

plot_ly(x = ~vasos1fCoronarioDataset$x, y = ~vasos1fCoronarioDataset$y, type = 'scatter', mode = 'lines', name = '1 vaso', fill = 'tozeroy')%>% 
  add_trace(x = ~vasos2fCoronarioDataset$x, y = ~vasos2fCoronarioDataset$y, name = '2 vasos', fill = 'tozeroy')%>%
  add_trace(x = ~vasos3fCoronarioDataset$x, y = ~vasos3fCoronarioDataset$y, name = '3 vasos', fill = 'tozeroy')%>%
  layout(xaxis = list(title = 'Age'),yaxis = list(title = 'Density'))

```

# 8. Frecuencia de desarrollo de vasos según angioplastiados
```{r ,echo=FALSE}
angioDA <- subset(angioSubset, angioSubset$DA==1)
angioCD <- subset(angioSubset,angioSubset$CD == 1)
angioCDPROX <- subset(angioSubset,angioSubset$CDPROXIMAL == 1)
angioCXPROX <- subset(angioSubset,angioSubset$CXPROXIMAL == 1)

plot_ly(alpha = 0.6) %>%
  add_histogram(x = angioDA$PROCEDIMIENTO, name = "DA") %>%
  add_histogram(x = angioCD$PROCEDIMIENTO, name = "CD") %>%
  add_histogram(x = angioCDPROX$PROCEDIMIENTO, name = "CD PROXIMAL") %>%
  add_histogram(x = angioCXPROX$PROCEDIMIENTO, name = "CX PROXIMAL") %>%
layout(barmode = "group", title = "")

```