---
title: ""
output: 
  html_document:
    toc: true
    toc_depth: 1
    toc_float: true
    theme: lumen  
    highlight: null
    css: bootstrap.css
    collapsed: false
---

```{r setup, include=FALSE}

#azul RGB: (31, 119, 180)
#naranja RGB: (255, 127, 14)

knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(plotly)

dataset <- read_excel("C:/Users/Pedro/Desktop/dataset.xlsx")
```

# TP Cardiac Events


# Data analysis

### Age frequency
```{r ,echo=FALSE}
less20 <- subset(dataset, dataset$EDAD <20)
between20n40 <- subset(dataset, dataset$EDAD >=20 & dataset$EDAD <40)
between40n60 <- subset(dataset, dataset$EDAD >=40 & dataset$EDAD <60)
between60n80 <- subset(dataset, dataset$EDAD >=60 & dataset$EDAD <80)
more80 <- subset(dataset, dataset$EDAD >=80)

color = c('rgba(31,119,180,1)','rgba(105,122,125,1)','rgba(183,124,67,1)', 'rgba(243,127,23,1)','rgba(255,127,14,1)')

plot_ly(alpha = 0.7, orientation = 'h', marker = list(color)) %>%
  add_histogram(y = more80$EDAD, name = "More than 80", marker = color{1}) %>%
  add_histogram(y = between60n80$EDAD, name = "Between 60 and 79") %>%
  add_histogram(y = between40n60$EDAD, name = "Between 40 and 59") %>%
  add_histogram(y = between20n40$EDAD, name = "Between 20 and 39") %>%
  add_histogram(y = less20$EDAD, name = "Less than 20") %>%
layout(barmode = "group", title = "",orientation="h")


```

### Gender
Many studies from different organizations such as (poner paper) have discovered

```{r ,echo=FALSE}
plot_ly(dataset, labels = ~SEXO, type = 'pie', width = 1) %>%
  layout(title = '',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

```

### Análisis de Relacion Edad - Sexo 
```{r ,echo=FALSE}
menSubset <- dataset[which(dataset$SEXO == "MASC"),]
density1 <- density(menSubset$EDAD)

womenSubset <- dataset[which(dataset$SEXO == "FEME"),]
density2 <- density(womenSubset$EDAD)

plot_ly(x = ~density1$x, y = density1$y*100, type = 'scatter', mode = 'lines', name = 'Men', fill = 'tozerox')%>% 
  add_trace(x = ~density2$x, y = density2$y*100, name = 'Women', fill = 'tozerox')%>% 
  layout(xaxis = list(title = 'Age'),yaxis = list(title = 'Density'))
```



### Frecuencia acumulada de procedimiento
```{r ,echo=FALSE}
dataset <- subset(dataset, dataset$PROCEDIMIENTO == "ANGIOPLASTIA" |dataset$PROCEDIMIENTO == "CIRUGIA")

plot_ly(alpha = 0.6,
        marker = list(color = c('rgba(0,48,94,0.7)', 'rgba(221,117,0,0.7)',
                                'rgba(204,204,204,0.7)', 'rgba(1,6,132,0.7)'))) %>%
  add_histogram(x = dataset$PROCEDIMIENTO, text = "ANGIOPLASTIC") %>%
  layout(barmode = "group", title = "")
```
#### Note: Due to the low quantity of patients in "Endoválvula" and "Cirugia,Endoválvula", we have decided not to include their data in our analysis 

### Procedimiento según factor de riesgo
```{r ,echo=FALSE}
diabetes <- subset(dataset, dataset$DIABETES ==1)
epoc  <- subset(dataset, dataset$EPOC ==1)
obesidadMor <- subset(dataset, dataset$`OBESIDAD MORBIDA` == 1)
plot_ly(alpha = 0.6) %>%
  add_histogram(x = diabetes$PROCEDIMIENTO, name = "Diabetes") %>%
  add_histogram(x = epoc$PROCEDIMIENTO, name = "EPOC") %>%
  add_histogram(x = obesidadMor$PROCEDIMIENTO, name = "Obesidad Morbida") %>%
  layout(barmode = "group", title = "")
```

### Procedimiento según la cantidad de vasos

```{r ,echo=FALSE}
cerovasos <- dataset[!complete.cases(dataset$`Resumen Coronariopatia`),]
unVaso <- subset(dataset, dataset$`Resumen Coronariopatia` == "1 vaso")
dosVasos <- subset(dataset, dataset$`Resumen Coronariopatia` == "2 vasos")
tresVasos <- subset(dataset, dataset$`Resumen Coronariopatia` == "3 vasos")

plot_ly(alpha = 0.6) %>%
  add_histogram(x = cerovasos$PROCEDIMIENTO, name = "Cero Vasos") %>%
  add_histogram(x = unVaso$PROCEDIMIENTO, name = "Un Vaso") %>%
  add_histogram(x = dosVasos$PROCEDIMIENTO, name = "Dos Vasos") %>%
  add_histogram(x = tresVasos$PROCEDIMIENTO, name = "Tres Vasos") %>%
layout(barmode = "group", title = "")
```

### Intervensión previa de ingresados
```{r ,echo=FALSE}
angioSubset <- subset(dataset, dataset$PROCEDIMIENTO == "ANGIOPLASTIA")
cirugiaSubset<- subset(dataset, dataset$PROCEDIMIENTO == "CIRUGIA")

plot_ly()%>%
  add_pie(labels = angioSubset$`INTERVENCION PREVIA`, values = angioSubset, domain = list(x = c(0, 0.4), y = c(0.5)), name = "Angioplastic",title = "Angioplastic")%>%
  add_pie(labels = cirugiaSubset$`INTERVENCION PREVIA`, values = cirugiaSubset, domain = list(x = c(0.6, 1), y = c(0.5)), name = "Surgery",title = "Surgery") %>%
  layout(title = "", showlegend = F,
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

```

### Vasos que desarrolla según sexo y edad
####### Hombres
```{r ,echo=FALSE}
menSubset <- dataset[which(dataset$SEXO == "MASC"),]

vasos1mCoronarioDataset <- density(subset(menSubset, menSubset$`Resumen Coronariopatia`=="1 vaso")$EDAD)

vasos2mCoronarioDataset <- density(subset(menSubset, menSubset$`Resumen Coronariopatia`=="2 vasos")$EDAD)

vasos3mCoronarioDataset <- density(subset(menSubset, menSubset$`Resumen Coronariopatia`=="3 vasos")$EDAD)

plot_ly(x = ~vasos1mCoronarioDataset$x, y = ~vasos1mCoronarioDataset$y*100, type = 'scatter', mode = 'lines', name = '1 vaso', fill = 'tozeroy')%>% 
  add_trace(x = ~vasos2mCoronarioDataset$x, y = ~vasos2mCoronarioDataset$y*100, name = '2 vasos', fill = 'tozeroy')%>%
  add_trace(x = ~vasos3mCoronarioDataset$x, y = ~vasos3mCoronarioDataset$y*100, name = '3 vasos', fill = 'tozeroy')%>%
  layout(xaxis = list(title = 'Age'),yaxis = list(title = 'Density'))

```

####### Mujeres

```{r ,echo=FALSE}
womenSubset <- dataset[which(dataset$SEXO == "FEME"),]

vasos1fCoronarioDataset <- density(subset(womenSubset, womenSubset$`Resumen Coronariopatia`=="1 vaso")$EDAD)
vasos2fCoronarioDataset <- density(subset(womenSubset, womenSubset$`Resumen Coronariopatia`=="2 vasos")$EDAD)
vasos3fCoronarioDataset <- density(subset(womenSubset, womenSubset$`Resumen Coronariopatia`=="3 vasos")$EDAD)

plot_ly(x = ~vasos1fCoronarioDataset$x, y = ~vasos1fCoronarioDataset$y*100, type = 'scatter', mode = 'lines', name = '1 vaso', fill = 'tozeroy')%>% 
  add_trace(x = ~vasos2fCoronarioDataset$x, y = ~vasos2fCoronarioDataset$y*100, name = '2 vasos', fill = 'tozeroy')%>%
  add_trace(x = ~vasos3fCoronarioDataset$x, y = ~vasos3fCoronarioDataset$y*100, name = '3 vasos', fill = 'tozeroy')%>%
  layout(xaxis = list(title = 'Age'),yaxis = list(title = 'Density'))

```

### Frecuencia de desarrollo de vasos según angioplastiados
```{r ,echo=FALSE}
angioDA <- subset(angioSubset, angioSubset$DA==1)
angioCD <- subset(angioSubset,angioSubset$CD == 1)
angioCDPROX <- subset(angioSubset,angioSubset$CDPROXIMAL == 1)
angioCXPROX <- subset(angioSubset,angioSubset$CXPROXIMAL == 1)

plot_ly(alpha = 0.6) %>%
  add_histogram(x = angioDA$PROCEDIMIENTO, name = "DA") %>%
  add_histogram(x = angioCD$PROCEDIMIENTO, name = "CD") %>%
  add_histogram(x = angioCDPROX$PROCEDIMIENTO, name = "CD PROXIMAL") %>%
  add_histogram(x = angioCXPROX$PROCEDIMIENTO, name = "CX PROXIMAL") %>%
layout(barmode = "group", title = "")

```

# Interpretation


# Predictor